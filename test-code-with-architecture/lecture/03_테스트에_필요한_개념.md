# 테스트에 필요한 개념

## 개념

### SUT System Under Test (테스트 하려는 대상)

```java
@Test
void 유저는_북마크를_toggle_추가_할_수있다() {
    //given
    User sut = User.builder()
        .bookmark(new ArrayList<>())
        .build();
    //when
    sut.toggleBookmark("my-link");
    //then
    boolean result = sut.hasBookmark("my-link");
    assertThat(result).isTrue();
}
```

위와 같이 사용자가 북마크했을때, 북마크 결과가 제대로 됐는지 확인하는테스트코드가 있다.

이경우에는 User가 테스트하려는 대상이므로 **User가 SUT이다.**



### BDD Behaviour driven development (given - when - then)

테스트를 작성하다 어느 순간, 어디에, 어떻게 테스트를 넣어야하지? 라는 질문을 마주한다.

이때 BDD가 답을 줄 수 있다. "행동에 집중해야한다"

그래서 User가 시스템을 사용하는 user Strory를 강조하고 시나리오를 강조한다.



### 상호작용 테스트 (Interaction test)

메소드가 실제로 호출됐는지를 검증하는 테스트이다.

But, 일반적으로 이렇게 메소드가 실제 호출되었는지 검증하는 방식은 좋은 방법이 아니다.

Why, 내부 구현을 어떻게 했는지 감시하는 것이기 때문 (캡슐화에 위배)



### 상태 검증 VS 행위 검증

* 상태 기반 검증이란?

  "어떤 값을 시스템에 넣었을 때, 나오는 결괏값을 기댓값과 비교하는 방식"

* 행위 기반 검증이란?

  " 어떤 값을 시스템에 넣었을 때, 협력 객체의 어떤 메서드를 실행하는지 보는 방식"



### 테스트 픽스쳐

테스트에 필요한 자원을 생성하는 것

이 강의에서는 테스트가 한눈에 잘 안들어오기 때문에, 선호하지 않는다고



### 비욘세 규칙

비욘세의 히트곡 싱글 레이디 중

"네가 나를 좋아했다면, 프로포즈를 했었어야지"

**"상태를 유지하고 싶었다면 테스트를 만들었어야지"**

* 유지하고 싶은 상태가 있으면 전부 테스트로 작성해라 그게 곧 정책이 될 것이

EX)

유저 아이디를 이메일형식으로만 받고싶다면 이메일이 아닐때 예외를 던지는 테스트를 만들고,

마일리지 쿠폰이 5만원 이상일 때만 사용 가능하게 만들고싶으면 5만원 미만이면 예외를 던지는 테스트를 만든



### Testbility

* 테스트 가능성, 소프트웨어가 테스트 가능한 구조인가?



### Test double

* 테스트 대역

> 예를들어
>
> 이메일을 발송하는 테스트를 할 때, 매번 이메일을 보내지 않고 이메일을 발송하는 부분에 가짜 객체를 넣어준다. 이럴때 사용하는 객체가 테스트 대역이다.

* 종류
  * Dummy : 아무런 동작도 하지 않고, 그저 코드가 정상적으로 돌아가기 위해 전달하는 객체
  * Fake : Local에서 사용하거나 테스트에서 사용하기 위해 만들어진 가짜 객체, 자체적인 로직이 있다는게 특징
  * Stub : 미리 준비된 값을 출력하는 객체 (보통 mockito로 작성함)
  * Mock : 메소드 호출을 확인하기 위한 객체, 자가 검증 능력을 갖춤
    (사실상 테스트 더블과 동일한 의미로 사용된다.)
  * Spy : 메소드 호출을 전부 기록했다가 나중에 확인하기 위한 객체